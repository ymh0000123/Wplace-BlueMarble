// ==UserScript==
// @name         Blue Marble - AI增强版
// @namespace    https://github.com/SwingTheVine/
// @version      0.85.0
// @description  A userscript to automate and/or enhance the user experience on Wplace.live. Make sure to comply with the site's Terms of Service, and rules! This script is not affiliated with Wplace.live in any way, use at your own risk. This script is not affiliated with TamperMonkey. The author of this userscript is not responsible for any damages, issues, loss of data, or punishment that may occur as a result of using this script. This script is provided "as is" under the MPL-2.0 license. The "Blue Marble" icon is licensed under CC0 1.0 Universal (CC0 1.0) Public Domain Dedication. The image is owned by NASA.
// @author       SwingTheVine
// @license      MPL-2.0
// @supportURL   https://discord.gg/tpeBPy46hf
// @homepageURL  https://bluemarble.camilledaguin.fr/
// @icon         https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/051271c433a42db968a865b00f81bb979ee7d13f/dist/assets/Favicon.png
// @updateURL    https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/main/dist/BlueMarble.user.js
// @downloadURL  https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/main/dist/BlueMarble.user.js
// @match        https://wplace.live/*
// @grant        GM_getResourceText
// @grant        GM_addStyle
// @grant        GM.setValue
// @grant        GM_getValue
// @grant        GM_xmlhttpRequest
// @connect      telemetry.thebluecorner.net
// @resource     CSS-BM-File https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/051271c433a42db968a865b00f81bb979ee7d13f/dist/BlueMarble.user.css
// ==/UserScript==

// Wplace  --> https://wplace.live
// License --> https://www.mozilla.org/en-US/MPL/2.0/

(()=>{var e,t,n=e=>{throw TypeError(e)},i=(e,t,i)=>t.has(e)?n("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,i),o=(e,t,i)=>(((e,t)=>{t.has(e)||n("Cannot access private method")})(e,t),i),a={"ui.move_up":{en:"Move ↑","zh-cn":"向上移动 ↑","zh-tw":"向上移動 ↑",ja:"上に移動 ↑",ko:"위로 이동 ↑",es:"Mover ↑",fr:"Déplacer ↑",de:"Nach oben ↑",ru:"Переместить ↑",pt:"Mover ↑"},"ui.move_down":{en:"Move ↓","zh-cn":"向下移动 ↓","zh-tw":"向下移動 ↓",ja:"下に移動 ↓",ko:"아래로 이동 ↓",es:"Mover ↓",fr:"Déplacer ↓",de:"Nach unten ↓",ru:"Переместить ↓",pt:"Mover ↓"},"ui.username":{en:"Username:","zh-cn":"用户名：","zh-tw":"使用者名稱：",ja:"ユーザー名：",ko:"사용자명:",es:"Usuario:",fr:"Nom d'utilisateur:",de:"Benutzername:",ru:"Имя пользователя:",pt:"Nome de usuário:"},"ui.droplets":{en:"Droplets:","zh-cn":"水滴：","zh-tw":"水滴：",ja:"ドロップレット：",ko:"드롭렛:",es:"Gotas:",fr:"Gouttelettes:",de:"Tröpfchen:",ru:"Капли:",pt:"Gotas:"},"ui.next_level":{en:"Next level in","zh-cn":"下一级需要","zh-tw":"下一級需要",ja:"次のレベルまで",ko:"다음 레벨까지",es:"Siguiente nivel en",fr:"Niveau suivant dans",de:"Nächstes Level in",ru:"Следующий уровень через",pt:"Próximo nível em"},"ui.pixel":{en:"pixel","zh-cn":"像素","zh-tw":"像素",ja:"ピクセル",ko:"픽셀",es:"píxel",fr:"pixel",de:"Pixel",ru:"пиксель",pt:"pixel"},"ui.pixels":{en:"pixels","zh-cn":"像素","zh-tw":"像素",ja:"ピクセル",ko:"픽셀",es:"píxeles",fr:"pixels",de:"Pixel",ru:"пикселей",pt:"pixels"},"ui.upload_template":{en:"Upload Template","zh-cn":"上传模板","zh-tw":"上傳模板",ja:"テンプレートをアップロード",ko:"템플릿 업로드",es:"Subir Plantilla",fr:"Télécharger le Modèle",de:"Vorlage Hochladen",ru:"Загрузить Шаблон",pt:"Carregar Modelo"},"ui.enable":{en:"Enable","zh-cn":"启用","zh-tw":"啟用",ja:"有効にする",ko:"활성화",es:"Habilitar",fr:"Activer",de:"Aktivieren",ru:"Включить",pt:"Ativar"},"ui.disable":{en:"Disable","zh-cn":"禁用","zh-tw":"禁用",ja:"無効にする",ko:"비활성화",es:"Deshabilitar",fr:"Désactiver",de:"Deaktivieren",ru:"Отключить",pt:"Desativar"},"ui.create":{en:"Create","zh-cn":"创建","zh-tw":"建立",ja:"作成",ko:"생성",es:"Crear",fr:"Créer",de:"Erstellen",ru:"Создать",pt:"Criar"},"ui.enable_all":{en:"Enable All","zh-cn":"全部启用","zh-tw":"全部啟用",ja:"すべて有効",ko:"모두 활성화",es:"Habilitar Todo",fr:"Tout Activer",de:"Alle Aktivieren",ru:"Включить Все",pt:"Ativar Todos"},"ui.disable_all":{en:"Disable All","zh-cn":"全部禁用","zh-tw":"全部禁用",ja:"すべて無効",ko:"모두 비활성화",es:"Deshabilitar Todo",fr:"Tout Désactiver",de:"Alle Deaktivieren",ru:"Отключить Все",pt:"Desativar Todos"},"ui.made_by":{en:"Made by SwingTheVine, AI-enhanced by xiaofeishu","zh-cn":"由 SwingTheVine 制作 由 xiaofeishu 使用AI增强","zh-tw":"由 SwingTheVine 製作 由 xiaofeishu 使用AI增強",ja:"SwingTheVine 制作、xiaofeishu によるAI強化",ko:"SwingTheVine 제작, xiaofeishu 에 의해 AI 강화",es:"Hecho por SwingTheVine, mejorado con IA por xiaofeishu",fr:"Fait par SwingTheVine, amélioré par IA par xiaofeishu",de:"Erstellt von SwingTheVine, KI-verbessert von xiaofeishu",ru:"Создано SwingTheVine, улучшено с помощью ИИ xiaofeishu",pt:"Feito por SwingTheVine, aprimorado por IA por xiaofeishu"},"ui.simplified_mode":{en:"Simplified Mode","zh-cn":"精简模式","zh-tw":"精簡模式",ja:"シンプルモード",ko:"간소 모드",es:"Modo Simplificado",fr:"Mode Simplifié",de:"Vereinfachter Modus",ru:"Упрощенный Режим",pt:"Modo Simplificado"},"ui.toggle_simplified":{en:"Toggle Simplified View","zh-cn":"切换精简视图","zh-tw":"切換精簡視圖",ja:"シンプル表示の切り替え",ko:"간소 보기 전환",es:"Alternar Vista Simplificada",fr:"Basculer Vue Simplifiée",de:"Vereinfachte Ansicht Umschalten",ru:"Переключить Упрощенный Вид",pt:"Alternar Visualização Simplificada"},"message.enabled_templates":{en:"Enabled templates!","zh-cn":"已启用模板！","zh-tw":"已啟用模板！",ja:"テンプレートを有効にしました！",ko:"템플릿이 활성화되었습니다!",es:"¡Plantillas habilitadas!",fr:"Modèles activés !",de:"Vorlagen aktiviert!",ru:"Шаблоны включены!",pt:"Modelos ativados!"},"message.disabled_templates":{en:"Disabled templates!","zh-cn":"已禁用模板！","zh-tw":"已禁用模板！",ja:"テンプレートを無効にしました！",ko:"템플릿이 비활성화되었습니다!",es:"¡Plantillas deshabilitadas!",fr:"Modèles désactivés !",de:"Vorlagen deaktiviert!",ru:"Шаблоны отключены!",pt:"Modelos desativados!"},"message.drew_to_canvas":{en:"Drew to canvas!","zh-cn":"已绘制到画布！","zh-tw":"已繪製到畫布！",ja:"キャンバスに描画しました！",ko:"캔버스에 그렸습니다!",es:"¡Dibujado en el lienzo!",fr:"Dessiné sur la toile !",de:"Auf Leinwand gezeichnet!",ru:"Нарисовано на холсте!",pt:"Desenhado na tela!"},"message.enabled_all_colors":{en:"Enabled all colors","zh-cn":"已启用所有颜色","zh-tw":"已啟用所有顏色",ja:"すべての色を有効にしました",ko:"모든 색상이 활성화됨",es:"Habilitados todos los colores",fr:"Toutes les couleurs activées",de:"Alle Farben aktiviert",ru:"Включены все цвета",pt:"Todas as cores ativadas"},"message.disabled_all_colors":{en:"Disabled all colors","zh-cn":"已禁用所有颜色","zh-tw":"已禁用所有顏色",ja:"すべての色を無効にしました",ko:"모든 색상이 비활성화됨",es:"Deshabilitados todos los colores",fr:"Toutes les couleurs désactivées",de:"Alle Farben deaktiviert",ru:"Отключены все цвета",pt:"Todas as cores desativadas"},"error.coordinates_malformed":{en:"Coordinates are malformed! Did you try clicking on the canvas first?","zh-cn":"坐标格式错误！您是否尝试先点击画布？","zh-tw":"座標格式錯誤！您是否嘗試先點擊畫布？",ja:"座標が不正です！まずキャンバスをクリックしてみましたか？",ko:"좌표가 잘못되었습니다! 먼저 캔버스를 클릭해 보셨나요?",es:"¡Las coordenadas están mal formadas! ¿Intentaste hacer clic en el lienzo primero?",fr:"Les coordonnées sont mal formées ! Avez-vous essayé de cliquer sur la toile d'abord ?",de:"Koordinaten sind fehlerhaft! Haben Sie zuerst auf die Leinwand geklickt?",ru:"Координаты неверны! Вы пробовали сначала нажать на холст?",pt:"As coordenadas estão mal formadas! Você tentou clicar na tela primeiro?"},"error.no_file_selected":{en:"No file selected!","zh-cn":"未选择文件！","zh-tw":"未選擇檔案！",ja:"ファイルが選択されていません！",ko:"파일이 선택되지 않았습니다!",es:"¡No se ha seleccionado ningún archivo!",fr:"Aucun fichier sélectionné !",de:"Keine Datei ausgewählt!",ru:"Файл не выбран!",pt:"Nenhum arquivo selecionado!"},"telemetry.title":{en:"{name} Telemetry","zh-cn":"{name} 遥测","zh-tw":"{name} 遙測",ja:"{name} テレメトリ",ko:"{name} 텔레메트리",es:"Telemetría de {name}",fr:"Télémétrie de {name}",de:"{name} Telemetrie",ru:"Телеметрия {name}",pt:"Telemetria do {name}"},"telemetry.more_info":{en:"More Information","zh-cn":"更多信息","zh-tw":"更多資訊",ja:"詳細情報",ko:"자세한 정보",es:"Más Información",fr:"Plus d'Informations",de:"Weitere Informationen",ru:"Подробнее",pt:"Mais Informações"},"telemetry.enable":{en:"Enable Telemetry","zh-cn":"启用遥测","zh-tw":"啟用遙測",ja:"テレメトリを有効にする",ko:"텔레메트리 활성화",es:"Habilitar Telemetría",fr:"Activer la Télémétrie",de:"Telemetrie Aktivieren",ru:"Включить Телеметрию",pt:"Ativar Telemetria"},"telemetry.disable":{en:"Disable Telemetry","zh-cn":"禁用遥测","zh-tw":"禁用遙測",ja:"テレメトリを無効にする",ko:"텔레메트리 비활성화",es:"Deshabilitar Telemetría",fr:"Désactiver la Télémétrie",de:"Telemetrie Deaktivieren",ru:"Отключить Телеметрию",pt:"Desativar Telemetria"},"telemetry.description":{en:"We collect anonymous telemetry data such as your browser, OS, and script version to make the experience better for everyone. The data is never shared personally. The data is never sold. You can turn this off by pressing the 'Disable' button, but keeping it on helps us improve features and reliability faster. Thank you for supporting the Blue Marble!","zh-cn":'我们收集匿名遥测数据，如您的浏览器、操作系统和脚本版本，以为每个人提供更好的体验。数据绝不会被个人分享。数据绝不会被出售。您可以通过按"禁用"按钮来关闭此功能，但保持开启有助于我们更快地改进功能和可靠性。感谢您支持 Blue Marble！',"zh-tw":"我們收集匿名遙測資料，如您的瀏覽器、作業系統和腳本版本，以為每個人提供更好的體驗。資料絕不會被個人分享。資料絕不會被出售。您可以透過按「禁用」按鈕來關閉此功能，但保持開啟有助於我們更快地改進功能和可靠性。感謝您支援 Blue Marble！",ja:"ブラウザ、OS、スクリプトバージョンなどの匿名テレメトリデータを収集して、すべての人により良い体験を提供します。データは個人的に共有されることはありません。データが売られることもありません。「無効」ボタンを押すことでこれをオフにできますが、オンのままにしておくと、機能と信頼性をより速く改善するのに役立ちます。Blue Marbleをサポートしていただき、ありがとうございます！",ko:"브라우저, OS, 스크립트 버전과 같은 익명 텔레메트리 데이터를 수집하여 모든 사람에게 더 나은 경험을 제공합니다. 데이터는 개인적으로 공유되지 않습니다. 데이터는 판매되지 않습니다. '비활성화' 버튼을 눌러 이를 끌 수 있지만, 켜두면 기능과 안정성을 더 빠르게 개선하는 데 도움이 됩니다. Blue Marble을 지원해 주셔서 감사합니다!",es:"Recopilamos datos de telemetría anónimos como su navegador, sistema operativo y versión del script para mejorar la experiencia para todos. Los datos nunca se comparten personalmente. Los datos nunca se venden. Puede desactivar esto presionando el botón 'Deshabilitar', pero mantenerlo activado nos ayuda a mejorar las características y la confiabilidad más rápido. ¡Gracias por apoyar Blue Marble!",fr:"Nous collectons des données de télémétrie anonymes telles que votre navigateur, OS et version du script pour améliorer l'expérience pour tout le monde. Les données ne sont jamais partagées personnellement. Les données ne sont jamais vendues. Vous pouvez désactiver ceci en appuyant sur le bouton 'Désactiver', mais le garder activé nous aide à améliorer les fonctionnalités et la fiabilité plus rapidement. Merci de soutenir Blue Marble !",de:"Wir sammeln anonyme Telemetriedaten wie Ihren Browser, Ihr Betriebssystem und die Skriptversion, um die Erfahrung für alle zu verbessern. Die Daten werden niemals persönlich geteilt. Die Daten werden niemals verkauft. Sie können dies deaktivieren, indem Sie die Schaltfläche 'Deaktivieren' drücken, aber das Eingeschaltetlassen hilft uns, Funktionen und Zuverlässigkeit schneller zu verbessern. Vielen Dank für die Unterstützung von Blue Marble!",ru:"Мы собираем анонимные телеметрические данные, такие как ваш браузер, ОС и версия скрипта, чтобы улучшить опыт для всех. Данные никогда не передаются лично. Данные никогда не продаются. Вы можете отключить это, нажав кнопку 'Отключить', но оставление включенным помогает нам быстрее улучшать функции и надежность. Спасибо за поддержку Blue Marble!",pt:"Coletamos dados de telemetria anônimos como seu navegador, SO e versão do script para melhorar a experiência para todos. Os dados nunca são compartilhados pessoalmente. Os dados nunca são vendidos. Você pode desativar isso pressionando o botão 'Desativar', mas mantê-lo ativado nos ajuda a melhorar recursos e confiabilidade mais rapidamente. Obrigado por apoiar o Blue Marble!"},"telemetry.disable_info":{en:'You can disable telemetry by pressing the "Disable" button below.',"zh-cn":'您可以通过按下面的"禁用"按钮来禁用遥测。',"zh-tw":"您可以透過按下面的「禁用」按鈕來禁用遙測。",ja:"下の「無効」ボタンを押すことでテレメトリを無効にできます。",ko:'아래 "비활성화" 버튼을 눌러 텔레메트리를 비활성화할 수 있습니다.',es:'Puede deshabilitar la telemetría presionando el botón "Deshabilitar" a continuación.',fr:'Vous pouvez désactiver la télémétrie en appuyant sur le bouton "Désactiver" ci-dessous.',de:'Sie können die Telemetrie deaktivieren, indem Sie unten auf die Schaltfläche "Deaktivieren" klicken.',ru:'Вы можете отключить телеметрию, нажав кнопку "Отключить" ниже.',pt:'Você pode desativar a telemetria pressionando o botão "Desativar" abaixo.'},"placeholder.tile_x":{en:"X coordinate","zh-cn":"X坐标","zh-tw":"X座標",ja:"X座標",ko:"X좌표",es:"Coordenada X",fr:"Coordonnée X",de:"X-Koordinate",ru:"Координата X",pt:"Coordenada X"},"placeholder.tile_y":{en:"Y coordinate","zh-cn":"Y坐标","zh-tw":"Y座標",ja:"Y座標",ko:"Y좌표",es:"Coordenada Y",fr:"Coordonnée Y",de:"Y-Koordinate",ru:"Координата Y",pt:"Coordenada Y"},"placeholder.pixel_x":{en:"Px X","zh-cn":"像素 X","zh-tw":"像素 X",ja:"ピクセル X",ko:"픽셀 X",es:"Píxel X",fr:"Pixel X",de:"Pixel X",ru:"Пиксель X",pt:"Pixel X"},"placeholder.pixel_y":{en:"Px Y","zh-cn":"像素 Y","zh-tw":"像素 Y",ja:"ピクセル Y",ko:"픽셀 Y",es:"Píxel Y",fr:"Pixel Y",de:"Pixel Y",ru:"Пиксель Y",pt:"Pixel Y"},"placeholder.status_sleeping":{en:"Status: Sleeping...\nVersion: {version}","zh-cn":"状态：休眠中...\n版本：{version}","zh-tw":"狀態：休眠中...\n版本：{version}",ja:"ステータス：スリープ中...\nバージョン：{version}",ko:"상태: 대기 중...\n버전: {version}",es:"Estado: Durmiendo...\nVersión: {version}",fr:"Statut: En veille...\nVersion: {version}",de:"Status: Schlafend...\nVersion: {version}",ru:"Статус: Спящий режим...\nВерсия: {version}",pt:"Status: Dormindo...\nVersão: {version}"},"placeholder.no_template_colors":{en:"No template colors to display.","zh-cn":"没有模板颜色可显示。","zh-tw":"沒有模板顏色可顯示。",ja:"表示するテンプレートカラーがありません。",ko:"표시할 템플릿 색상이 없습니다.",es:"No hay colores de plantilla para mostrar.",fr:"Aucune couleur de modèle à afficher.",de:"Keine Vorlagenfarben zum Anzeigen.",ru:"Нет цветов шаблона для отображения.",pt:"Nenhuma cor de modelo para exibir."},"tooltip.minimize_maximize":{en:"Blue Marble Icon - Click to minimize/maximize","zh-cn":"Blue Marble 图标 - 点击最小化/最大化","zh-tw":"Blue Marble 圖示 - 點擊最小化/最大化",ja:"Blue Marble アイコン - クリックで最小化/最大化",ko:"Blue Marble 아이콘 - 클릭하여 최소화/최대화",es:"Icono de Blue Marble - Haz clic para minimizar/maximizar",fr:"Icône Blue Marble - Cliquez pour minimiser/maximiser",de:"Blue Marble Icon - Klicken zum Minimieren/Maximieren",ru:"Иконка Blue Marble - Нажмите для минимизации/максимизации",pt:"Ícone Blue Marble - Clique para minimizar/maximizar"},"tooltip.minimized":{en:"Blue Marble Icon - Minimized (Click to maximize)","zh-cn":"Blue Marble 图标 - 已最小化（点击最大化）","zh-tw":"Blue Marble 圖示 - 已最小化（點擊最大化）",ja:"Blue Marble アイコン - 最小化済み（クリックで最大化）",ko:"Blue Marble 아이콘 - 최소화됨 (클릭하여 최대화)",es:"Icono de Blue Marble - Minimizado (Haz clic para maximizar)",fr:"Icône Blue Marble - Minimisé (Cliquez pour maximiser)",de:"Blue Marble Icon - Minimiert (Klicken zum Maximieren)",ru:"Иконка Blue Marble - Минимизирована (Нажмите для максимизации)",pt:"Ícone Blue Marble - Minimizado (Clique para maximizar)"},"tooltip.maximized":{en:"Blue Marble Icon - Maximized (Click to minimize)","zh-cn":"Blue Marble 图标 - 已最大化（点击最小化）","zh-tw":"Blue Marble 圖示 - 已最大化（點擊最小化）",ja:"Blue Marble アイコン - 最大化済み（クリックで最小化）",ko:"Blue Marble 아이콘 - 최대화됨 (클릭하여 최소화)",es:"Icono de Blue Marble - Maximizado (Haz clic para minimizar)",fr:"Icône Blue Marble - Maximisé (Cliquez pour minimiser)",de:"Blue Marble Icon - Maximiert (Klicken zum Minimieren)",ru:"Иконка Blue Marble - Максимизирована (Нажмите для минимизации)",pt:"Ícone Blue Marble - Maximizado (Clique para minimizar)"},"tooltip.template_color_converter":{en:"Template Color Converter","zh-cn":"模板颜色转换器","zh-tw":"模板顏色轉換器",ja:"テンプレートカラーコンバーター",ko:"템플릿 색상 변환기",es:"Convertidor de Colores de Plantilla",fr:"Convertisseur de Couleurs de Modèle",de:"Vorlagen-Farbkonverter",ru:"Конвертер Цветов Шаблона",pt:"Conversor de Cores de Modelo"},"tooltip.official_website":{en:"Official Blue Marble Website","zh-cn":"Blue Marble 官方网站","zh-tw":"Blue Marble 官方網站",ja:"Blue Marble 公式ウェブサイト",ko:"공식 Blue Marble 웹사이트",es:"Sitio Web Oficial de Blue Marble",fr:"Site Web Officiel de Blue Marble",de:"Offizielle Blue Marble Website",ru:"Официальный сайт Blue Marble",pt:"Site Oficial do Blue Marble"},"color.other":{en:"Other","zh-cn":"其他","zh-tw":"其他",ja:"その他",ko:"기타",es:"Otro",fr:"Autre",de:"Andere",ru:"Другое",pt:"Outro"},"color.transparent":{en:"Transparent","zh-cn":"透明","zh-tw":"透明",ja:"透明",ko:"투명",es:"Transparente",fr:"Transparent",de:"Transparent",ru:"Прозрачный",pt:"Transparente"},"ui.language":{en:"Language:","zh-cn":"语言：","zh-tw":"語言：",ja:"言語：",ko:"언어:",es:"Idioma:",fr:"Langue:",de:"Sprache:",ru:"Язык:",pt:"Idioma:"},"lang.en":{en:"English","zh-cn":"English","zh-tw":"English",ja:"English",ko:"English",es:"English",fr:"English",de:"English",ru:"English",pt:"English"},"lang.zh-cn":{en:"简体中文","zh-cn":"简体中文","zh-tw":"简体中文",ja:"简体中文",ko:"简体中文",es:"简体中文",fr:"简体中文",de:"简体中文",ru:"简体中文",pt:"简体中文"},"lang.zh-tw":{en:"繁體中文","zh-cn":"繁體中文","zh-tw":"繁體中文",ja:"繁體中文",ko:"繁體中文",es:"繁體中文",fr:"繁體中文",de:"繁體中文",ru:"繁體中文",pt:"繁體中文"},"lang.ja":{en:"日本語","zh-cn":"日本語","zh-tw":"日本語",ja:"日本語",ko:"日本語",es:"日本語",fr:"日本語",de:"日本語",ru:"日本語",pt:"日本語"},"lang.ko":{en:"한국어","zh-cn":"한국어","zh-tw":"한국어",ja:"한국어",ko:"한국어",es:"한국어",fr:"한국어",de:"한국어",ru:"한국어",pt:"한국어"},"lang.es":{en:"Español","zh-cn":"Español","zh-tw":"Español",ja:"Español",ko:"Español",es:"Español",fr:"Español",de:"Español",ru:"Español",pt:"Español"},"lang.fr":{en:"Français","zh-cn":"Français","zh-tw":"Français",ja:"Français",ko:"Français",es:"Français",fr:"Français",de:"Français",ru:"Français",pt:"Français"},"lang.de":{en:"Deutsch","zh-cn":"Deutsch","zh-tw":"Deutsch",ja:"Deutsch",ko:"Deutsch",es:"Deutsch",fr:"Deutsch",de:"Deutsch",ru:"Deutsch",pt:"Deutsch"},"lang.ru":{en:"Русский","zh-cn":"Русский","zh-tw":"Русский",ja:"Русский",ko:"Русский",es:"Русский",fr:"Русский",de:"Русский",ru:"Русский",pt:"Русский"},"lang.pt":{en:"Português","zh-cn":"Português","zh-tw":"Português",ja:"Português",ko:"Português",es:"Português",fr:"Português",de:"Português",ru:"Português",pt:"Português"},"console.userscript_loaded":{en:"({version}) userscript has loaded!","zh-cn":"({version}) 用户脚本已加载！","zh-tw":"({version}) 使用者腳本已載入！",ja:"({version}) ユーザースクリプトが読み込まれました！",ko:"({version}) 사용자 스크립트가 로드되었습니다!",es:"¡El userscript ({version}) se ha cargado!",fr:"Le userscript ({version}) s'est chargé !",de:"Userscript ({version}) wurde geladen!",ru:"Пользовательский скрипт ({version}) загружен!",pt:"O userscript ({version}) foi carregado!"}},r="en";function s(e,t={}){const n=a[e];if(!n)return"undefined"!=typeof console&&console.warn&&console.warn(`Translation key not found: ${e}`),e;let i=n[r]||n.en||Object.values(n)[0]||e;return t&&"object"==typeof t&&Object.keys(t).forEach(e=>{const n=`{${e}}`;i=i.replace(new RegExp(n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),t[e])}),i}r=function(){try{const e=JSON.parse(GM_getValue("bmUserSettings","{}"));if(e.language&&Object.keys(a).some(t=>a[t][e.language]))return e.language}catch(e){}const e=(navigator.language||navigator.userLanguage||"en").toLowerCase();if(e.includes("zh"))return e.includes("tw")||e.includes("hk")||e.includes("mo")?"zh-tw":"zh-cn";const t=["en","ja","ko","es","fr","de","ru","pt"];for(const n of t)if(e.startsWith(n))return n;return"en"}();var l=class{constructor(t,n){i(this,e),this.name=t,this.version=n,this.t=null,this.i="bm-o",this.o=null,this.l=null,this.m=[]}u(e){this.t=e}h(){return this.m.length>0&&(this.l=this.m.pop()),this}p(e){e?.appendChild(this.o),this.o=null,this.l=null,this.m=[]}v(n={},i=()=>{}){return i(this,o(this,e,t).call(this,"div",{},n)),this}M(n={},i=()=>{}){return i(this,o(this,e,t).call(this,"p",{},n)),this}$(n={},i=()=>{}){return i(this,o(this,e,t).call(this,"small",{},n)),this}k(n={},i=()=>{}){return i(this,o(this,e,t).call(this,"img",{},n)),this}S(n,i={},a=()=>{}){return a(this,o(this,e,t).call(this,"h"+n,{},i)),this}T(n={},i=()=>{}){return i(this,o(this,e,t).call(this,"hr",{},n)),this}D(n={},i=()=>{}){return i(this,o(this,e,t).call(this,"br",{},n)),this}O(n={},i=()=>{}){const a=o(this,e,t).call(this,"label",{textContent:n.textContent??""});delete n.textContent;const r=o(this,e,t).call(this,"input",{type:"checkbox"},n);return a.insertBefore(r,a.firstChild),this.h(),i(this,a,r),this}_(n={},i=()=>{}){return i(this,o(this,e,t).call(this,"button",{},n)),this}B(n={},i=()=>{}){const a=n.title??n.textContent??"Help: No info";delete n.textContent,n.title=`Help: ${a}`;const r={textContent:"?",className:"bm-D",onclick:()=>{this.j(this.i,a)}};return i(this,o(this,e,t).call(this,"button",r,n)),this}C(n={},i=()=>{}){return i(this,o(this,e,t).call(this,"input",{},n)),this}N(n={},i=()=>{}){return i(this,o(this,e,t).call(this,"select",{},n)),this}I(n={},i=()=>{}){const a=n.textContent??"";delete n.textContent;const r=o(this,e,t).call(this,"div"),s=o(this,e,t).call(this,"input",{type:"file",style:"display: none !important; visibility: hidden !important; position: absolute !important; left: -9999px !important; width: 0 !important; height: 0 !important; opacity: 0 !important;"},n);this.h();const l=o(this,e,t).call(this,"button",{textContent:a});return this.h(),this.h(),s.setAttribute("tabindex","-1"),s.setAttribute("aria-hidden","true"),l.addEventListener("click",()=>{s.click()}),s.addEventListener("change",()=>{l.style.maxWidth=`${l.offsetWidth}px`,s.files.length>0?l.textContent=s.files[0].name:l.textContent=a}),i(this,r,s,l),this}P(n={},i=()=>{}){return i(this,o(this,e,t).call(this,"textarea",{},n)),this}j(e,t,n=!1){const i=document.getElementById(e.replace(/^#/,""));i&&(i instanceof HTMLInputElement?i.value=t:n?i.textContent=t:i.innerHTML=t)}A(e,t){let n,i=!1,o=0,a=null,r=0,s=0,l=0,c=0;if(e=document.querySelector("#"==e?.[0]?e:"#"+e),t=document.querySelector("#"==t?.[0]?t:"#"+t),!e||!t)return void this.L(`Can not drag! ${e?"":"moveMe"} ${e||t?"":"and "}${t?"":"iMoveThings "}was not found!`);const m=()=>{if(i){const t=Math.abs(r-l),n=Math.abs(s-c);(t>.5||n>.5)&&(r=l,s=c,e.style.transform=`translate(${r}px, ${s}px)`,e.style.left="0px",e.style.top="0px",e.style.right=""),a=requestAnimationFrame(m)}};let u=null;const d=(d,h)=>{i=!0,u=e.getBoundingClientRect(),n=d-u.left,o=h-u.top;const p=window.getComputedStyle(e).transform;if(p&&"none"!==p){const e=new DOMMatrix(p);r=e.m41,s=e.m42}else r=u.left,s=u.top;l=r,c=s,document.body.style.userSelect="none",t.classList.add("dragging"),a&&cancelAnimationFrame(a),m()},h=()=>{i=!1,a&&(cancelAnimationFrame(a),a=null),document.body.style.userSelect="",t.classList.remove("dragging")};t.addEventListener("mousedown",function(e){e.preventDefault(),d(e.clientX,e.clientY)}),t.addEventListener("touchstart",function(e){const t=e?.touches?.[0];t&&(d(t.clientX,t.clientY),e.preventDefault())},{passive:!1}),document.addEventListener("mousemove",function(e){i&&u&&(l=e.clientX-n,c=e.clientY-o)},{passive:!0}),document.addEventListener("touchmove",function(e){if(i&&u){const t=e?.touches?.[0];if(!t)return;l=t.clientX-n,c=t.clientY-o,e.preventDefault()}},{passive:!1}),document.addEventListener("mouseup",h),document.addEventListener("touchend",h),document.addEventListener("touchcancel",h)}V(e){(0,console.info)(`${this.name}: ${e}`),this.j(this.i,"Status: "+e,!0)}L(e){(0,console.error)(`${this.name}: ${e}`),this.j(this.i,"Error: "+e,!0)}};function c(...e){(0,console.error)(...e)}function m(e,t){if(0===e)return t[0];let n="";const i=t.length;for(;e>0;)n=t[e%i]+n,e=Math.floor(e/i);return n}function u(e){let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function d(e){const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}e=new WeakSet,t=function(e,t={},n={}){const i=document.createElement(e);this.o?(this.l?.appendChild(i),this.m.push(this.l),this.l=i):(this.o=i,this.l=i);for(const[e,n]of Object.entries(t))i[e]=n;for(const[e,t]of Object.entries(n))i[e]=t;return i};var h,p,b,f,g,w,v=[{id:0,premium:!1,name:"Transparent",rgb:[0,0,0]},{id:1,premium:!1,name:"Black",rgb:[0,0,0]},{id:2,premium:!1,name:"Dark Gray",rgb:[60,60,60]},{id:3,premium:!1,name:"Gray",rgb:[120,120,120]},{id:4,premium:!1,name:"Light Gray",rgb:[210,210,210]},{id:5,premium:!1,name:"White",rgb:[255,255,255]},{id:6,premium:!1,name:"Deep Red",rgb:[96,0,24]},{id:7,premium:!1,name:"Red",rgb:[237,28,36]},{id:8,premium:!1,name:"Orange",rgb:[255,127,39]},{id:9,premium:!1,name:"Gold",rgb:[246,170,9]},{id:10,premium:!1,name:"Yellow",rgb:[249,221,59]},{id:11,premium:!1,name:"Light Yellow",rgb:[255,250,188]},{id:12,premium:!1,name:"Dark Green",rgb:[14,185,104]},{id:13,premium:!1,name:"Green",rgb:[19,230,123]},{id:14,premium:!1,name:"Light Green",rgb:[135,255,94]},{id:15,premium:!1,name:"Dark Teal",rgb:[12,129,110]},{id:16,premium:!1,name:"Teal",rgb:[16,174,166]},{id:17,premium:!1,name:"Light Teal",rgb:[19,225,190]},{id:18,premium:!1,name:"Dark Blue",rgb:[40,80,158]},{id:19,premium:!1,name:"Blue",rgb:[64,147,228]},{id:20,premium:!1,name:"Cyan",rgb:[96,247,242]},{id:21,premium:!1,name:"Indigo",rgb:[107,80,246]},{id:22,premium:!1,name:"Light Indigo",rgb:[153,177,251]},{id:23,premium:!1,name:"Dark Purple",rgb:[120,12,153]},{id:24,premium:!1,name:"Purple",rgb:[170,56,185]},{id:25,premium:!1,name:"Light Purple",rgb:[224,159,249]},{id:26,premium:!1,name:"Dark Pink",rgb:[203,0,122]},{id:27,premium:!1,name:"Pink",rgb:[236,31,128]},{id:28,premium:!1,name:"Light Pink",rgb:[243,141,169]},{id:29,premium:!1,name:"Dark Brown",rgb:[104,70,52]},{id:30,premium:!1,name:"Brown",rgb:[149,104,42]},{id:31,premium:!1,name:"Beige",rgb:[248,178,119]},{id:32,premium:!0,name:"Medium Gray",rgb:[170,170,170]},{id:33,premium:!0,name:"Dark Red",rgb:[165,14,30]},{id:34,premium:!0,name:"Light Red",rgb:[250,128,114]},{id:35,premium:!0,name:"Dark Orange",rgb:[228,92,26]},{id:36,premium:!0,name:"Light Tan",rgb:[214,181,148]},{id:37,premium:!0,name:"Dark Goldenrod",rgb:[156,132,49]},{id:38,premium:!0,name:"Goldenrod",rgb:[197,173,49]},{id:39,premium:!0,name:"Light Goldenrod",rgb:[232,212,95]},{id:40,premium:!0,name:"Dark Olive",rgb:[74,107,58]},{id:41,premium:!0,name:"Olive",rgb:[90,148,74]},{id:42,premium:!0,name:"Light Olive",rgb:[132,197,115]},{id:43,premium:!0,name:"Dark Cyan",rgb:[15,121,159]},{id:44,premium:!0,name:"Light Cyan",rgb:[187,250,242]},{id:45,premium:!0,name:"Light Blue",rgb:[125,199,255]},{id:46,premium:!0,name:"Dark Indigo",rgb:[77,49,184]},{id:47,premium:!0,name:"Dark Slate Blue",rgb:[74,66,132]},{id:48,premium:!0,name:"Slate Blue",rgb:[122,113,196]},{id:49,premium:!0,name:"Light Slate Blue",rgb:[181,174,241]},{id:50,premium:!0,name:"Light Brown",rgb:[219,164,99]},{id:51,premium:!0,name:"Dark Beige",rgb:[209,128,81]},{id:52,premium:!0,name:"Light Beige",rgb:[255,197,165]},{id:53,premium:!0,name:"Dark Peach",rgb:[155,82,73]},{id:54,premium:!0,name:"Peach",rgb:[209,128,120]},{id:55,premium:!0,name:"Light Peach",rgb:[250,182,164]},{id:56,premium:!0,name:"Dark Tan",rgb:[123,99,82]},{id:57,premium:!0,name:"Tan",rgb:[156,132,107]},{id:58,premium:!0,name:"Dark Slate",rgb:[51,57,65]},{id:59,premium:!0,name:"Slate",rgb:[109,117,141]},{id:60,premium:!0,name:"Light Slate",rgb:[179,185,209]},{id:61,premium:!0,name:"Dark Stone",rgb:[109,100,63]},{id:62,premium:!0,name:"Stone",rgb:[148,140,107]},{id:63,premium:!0,name:"Light Stone",rgb:[205,197,158]}],y=class{constructor({displayName:e="My template",F:t=0,G:n="",url:i="",file:o=null,coords:a=null,X:r=null,Y:s=1e3}={}){this.displayName=e,this.F=t,this.G=n,this.url=i,this.file=o,this.coords=a,this.X=r,this.Y=s,this.W=0,this.J=0,this.q=0,this.H={},this.U=new Set,this.R=null;const l=Array.isArray(v)?v:[];this.K=new Set(l.filter(e=>"transparent"!==(e?.name||"").toLowerCase()&&Array.isArray(e?.rgb)).map(e=>`${e.rgb[0]},${e.rgb[1]},${e.rgb[2]}`));const c="222,250,206";this.K.add(c);const m="other";this.K.add(m),this.Z=new Map(l.filter(e=>Array.isArray(e?.rgb)).map(e=>[`${e.rgb[0]},${e.rgb[1]},${e.rgb[2]}`,{id:e.id,premium:!!e.premium,name:e.name}]));try{const e=l.find(e=>"transparent"===(e?.name||"").toLowerCase());e&&Array.isArray(e.rgb)&&this.Z.set(c,{id:e.id,premium:!!e.premium,name:e.name})}catch(e){}try{this.Z.set(m,{id:"other",premium:!1,name:"Other"})}catch(e){}console.log("Allowed colors for template:",this.K)}async ee(){console.log("Template coordinates:",this.coords);const e=await createImageBitmap(this.file),t=e.width,n=e.height,i=t*n;console.log(`Template pixel analysis - Dimensions: ${t}×${n} = ${i.toLocaleString()} pixels`),this.W=i;try{const i=new OffscreenCanvas(t,n).getContext("2d",{te:!0});i.imageSmoothingEnabled=!1,i.clearRect(0,0,t,n),i.drawImage(e,0,0);const o=i.getImageData(0,0,t,n).data;let a=0,r=0;const s=new Map;for(let e=0;e<n;e++)for(let n=0;n<t;n++){const i=4*(e*t+n),l=o[i],c=o[i+1],m=o[i+2];if(0===o[i+3])continue;222===l&&250===c&&206===m&&r++;const u=this.K.has(`${l},${c},${m}`)?`${l},${c},${m}`:"other";a++,s.set(u,(s.get(u)||0)+1)}this.J=a,this.q=r;const l={};for(const[e,t]of s.entries())l[e]={count:t,enabled:!0};this.H=l}catch(e){this.J=Math.max(0,this.W),this.q=0,console.warn("Failed to compute required/deface counts. Falling back to total pixels.",e)}const o={},a={},r=new OffscreenCanvas(this.Y,this.Y),s=r.getContext("2d",{te:!0});for(let i=this.coords[3];i<n+this.coords[3];){const l=Math.min(this.Y-i%this.Y,n-(i-this.coords[3]));console.log(`Math.min(${this.Y} - (${i} % ${this.Y}), ${n} - (${i-this.coords[3]}))`);for(let n=this.coords[2];n<t+this.coords[2];){console.log(`Pixel X: ${n}\nPixel Y: ${i}`);const c=Math.min(this.Y-n%this.Y,t-(n-this.coords[2]));console.log(`Math.min(${this.Y} - (${n} % ${this.Y}), ${t} - (${n-this.coords[2]}))`),console.log(`Draw Size X: ${c}\nDraw Size Y: ${l}`);const m=3*c,d=3*l;r.width=m,r.height=d,console.log(`Draw X: ${c}\nDraw Y: ${l}\nCanvas Width: ${m}\nCanvas Height: ${d}`),s.imageSmoothingEnabled=!1,console.log(`Getting X ${n}-${n+c}\nGetting Y ${i}-${i+l}`),s.clearRect(0,0,m,d),s.drawImage(e,n-this.coords[2],i-this.coords[3],c,l,0,0,3*c,3*l);const h=s.getImageData(0,0,m,d);for(let e=0;e<d;e++)for(let t=0;t<m;t++){const n=4*(e*m+t);if(222===h.data[n]&&250===h.data[n+1]&&206===h.data[n+2])(t+e)%2==0?(h.data[n]=0,h.data[n+1]=0,h.data[n+2]=0):(h.data[n]=255,h.data[n+1]=255,h.data[n+2]=255),h.data[n+3]=32;else if(t%3!=1||e%3!=1)h.data[n+3]=0;else{const e=h.data[n],t=h.data[n+1],i=h.data[n+2];this.K.has(`${e},${t},${i}`)}}console.log(`Shreaded pixels for ${n}, ${i}`,h),s.putImageData(h,0,0);const p=`${(this.coords[0]+Math.floor(n/1e3)).toString().padStart(4,"0")},${(this.coords[1]+Math.floor(i/1e3)).toString().padStart(4,"0")},${(n%1e3).toString().padStart(3,"0")},${(i%1e3).toString().padStart(3,"0")}`;o[p]=await createImageBitmap(r),this.U.add(p.split(",").slice(0,2).join(","));const b=await r.convertToBlob(),f=await b.arrayBuffer(),g=Array.from(new Uint8Array(f));a[p]=u(g),console.log(o),n+=c}i+=l}return console.log("Template Tiles: ",o),console.log("Template Tiles Buffers: ",a),{ne:o,ie:a}}};h=new WeakSet,p=async function(){GM.setValue("bmTemplates",JSON.stringify(this.oe))},b=async function(e){console.log("Parsing BlueMarble...");const t=e.templates;if(console.log(`BlueMarble length: ${Object.keys(t).length}`),Object.keys(t).length>0){for(const e in t){const n=e,i=t[e];if(console.log(n),t.hasOwnProperty(e)){const e=n.split(" "),o=Number(e?.[0]),a=e?.[1]||"0",r=i.name||`Template ${o||""}`,s=i.tiles,l={};let c=0;const m=new Map;for(const e in s)if(console.log(e),s.hasOwnProperty(e)){const t=d(s[e]),n=new Blob([t],{type:"image/png"}),i=await createImageBitmap(n);l[e]=i;try{const e=i.width,t=i.height,n=new OffscreenCanvas(e,t).getContext("2d",{te:!0});n.imageSmoothingEnabled=!1,n.clearRect(0,0,e,t),n.drawImage(i,0,0);const o=n.getImageData(0,0,e,t).data;for(let n=0;n<t;n++)for(let t=0;t<e;t++){if(t%this.ae!==1||n%this.ae!==1)continue;const i=4*(n*e+t),a=o[i],r=o[i+1],s=o[i+2];if(o[i+3]<64)continue;if(222===a&&250===r&&206===s)continue;c++;const l=activeTemplate.K.has(`${a},${r},${s}`)?`${a},${r},${s}`:"other";m.set(l,(m.get(l)||0)+1)}}catch(e){console.warn("Failed to count required pixels for imported tile",e)}}const u=new y({displayName:r,F:o||this.re?.length||0,G:a||""});u.X=l,u.J=c;const h={};for(const[e,t]of m.entries())h[e]={count:t,enabled:!0};u.H=h;try{Object.keys(l).forEach(e=>{u.U?.add(e.split(",").slice(0,2).join(","))})}catch(e){}try{const e=t?.[n]?.palette;if(e)for(const[t,n]of Object.entries(e))u.H[t]?u.H[t].enabled=!!n?.enabled:u.H[t]={count:n?.count||0,enabled:!!n?.enabled}}catch(e){}u.R=n,this.re.push(u),console.log(this.re),console.log("^^^ This ^^^")}}try{const e=document.querySelector("#bm-9");e&&(e.style.display=""),window.postMessage({source:"blue-marble",se:"bm-b"},"*")}catch(e){}}},f=new WeakSet,g=async function(e=navigator.userAgent){return(e=e||"").includes("OPR/")||e.includes("Opera")?"Opera":e.includes("Edg/")?"Edge":e.includes("Vivaldi")?"Vivaldi":e.includes("YaBrowser")?"Yandex":e.includes("Kiwi")?"Kiwi":e.includes("Brave")?"Brave":e.includes("Firefox/")?"Firefox":e.includes("Chrome/")?"Chrome":e.includes("Safari/")?"Safari":navigator.brave&&"function"==typeof navigator.brave.isBrave&&await navigator.brave.isBrave()?"Brave":"Unknown"},w=function(e=navigator.userAgent){return/Windows NT 11/i.test(e=e||"")?"Windows 11":/Windows NT 10/i.test(e)?"Windows 10":/Windows NT 6\.3/i.test(e)?"Windows 8.1":/Windows NT 6\.2/i.test(e)?"Windows 8":/Windows NT 6\.1/i.test(e)?"Windows 7":/Windows NT 6\.0/i.test(e)?"Windows Vista":/Windows NT 5\.1|Windows XP/i.test(e)?"Windows XP":/Mac OS X 10[_\.]15/i.test(e)?"macOS Catalina":/Mac OS X 10[_\.]14/i.test(e)?"macOS Mojave":/Mac OS X 10[_\.]13/i.test(e)?"macOS High Sierra":/Mac OS X 10[_\.]12/i.test(e)?"macOS Sierra":/Mac OS X 10[_\.]11/i.test(e)?"OS X El Capitan":/Mac OS X 10[_\.]10/i.test(e)?"OS X Yosemite":/Mac OS X 10[_\.]/i.test(e)?"macOS":/Android/i.test(e)?"Android":/iPhone|iPad|iPod/i.test(e)?"iOS":/Linux/i.test(e)?"Linux":"Unknown"};var x=GM_info.script.name.toString(),z=GM_info.script.version.toString();!function(e){const t=document.createElement("script");t.setAttribute("bm-E",x),t.setAttribute("bm-B","color: cornflowerblue;"),t.textContent=`(${e})();`,document.documentElement?.appendChild(t),t.remove()}(()=>{const e=document.currentScript,t=e?.getAttribute("bm-E")||"Blue Marble",n=e?.getAttribute("bm-B")||"",i=new Map;window.addEventListener("message",e=>{const{source:o,endpoint:a,blobID:r,blobData:s,blink:l}=e.data,c=Date.now()-l;if(console.groupCollapsed(`%c${t}%c: ${i.size} Recieved IMAGE message about blob "${r}"`,n,""),console.log(`Blob fetch took %c${String(Math.floor(c/6e4)).padStart(2,"0")}:${String(Math.floor(c/1e3)%60).padStart(2,"0")}.${String(c%1e3).padStart(3,"0")}%c MM:SS.mmm`,n,""),console.log(i),console.groupEnd(),"blue-marble"==o&&r&&s&&!a){const e=i.get(r);"function"==typeof e?e(s):function(...e){(0,console.warn)(...e)}(`%c${t}%c: Attempted to retrieve a blob (%s) from queue, but the blobID was not a function! Skipping...`,n,"",r),i.delete(r)}});const o=window.fetch;window.fetch=async function(...e){const a=await o.apply(this,e),r=a.clone(),s=(e[0]instanceof Request?e[0]?.url:e[0])||"ignore",l=r.headers.get("content-type")||"";if(l.includes("application/json"))console.log(`%c${t}%c: Sending JSON message about endpoint "${s}"`,n,""),r.json().then(e=>{window.postMessage({source:"blue-marble",endpoint:s,jsonData:e},"*")}).catch(e=>{console.error(`%c${t}%c: Failed to parse JSON: `,n,"",e)});else if(l.includes("image/")&&!s.includes("openfreemap")&&!s.includes("maps")){const e=Date.now(),o=await r.blob();return console.log(`%c${t}%c: ${i.size} Sending IMAGE message about endpoint "${s}"`,n,""),new Promise(a=>{const l=crypto.randomUUID();i.set(l,e=>{a(new Response(e,{headers:r.headers,status:r.status,statusText:r.statusText})),console.log(`%c${t}%c: ${i.size} Processed blob "${l}"`,n,"")}),window.postMessage({source:"blue-marble",endpoint:s,blobID:l,blobData:o,blink:e})}).catch(o=>{const a=Date.now();console.error(`%c${t}%c: Failed to Promise blob!`,n,""),console.groupCollapsed(`%c${t}%c: Details of failed blob Promise:`,n,""),console.log(`Endpoint: ${s}\nThere are ${i.size} blobs processing...\nBlink: ${e.toLocaleString()}\nTime Since Blink: ${String(Math.floor(a/6e4)).padStart(2,"0")}:${String(Math.floor(a/1e3)%60).padStart(2,"0")}.${String(a%1e3).padStart(3,"0")} MM:SS.mmm`),console.error("Exception stack:",o),console.groupEnd()})}return a}});var M=GM_getResourceText("CSS-BM-File");GM_addStyle(M);var $=document.createElement("link");$.href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap",$.rel="preload",$.as="style",$.onload=function(){this.onload=null,this.rel="stylesheet"},document.head?.appendChild($),new class{constructor(){this.le=null,this.ce=null,this.me="#bm-h"}ue(e){return this.ce=e,this.le=new MutationObserver(e=>{for(const t of e)for(const e of t.addedNodes)e instanceof HTMLElement&&e.matches?.(this.me)}),this}he(){return this.le}observe(e,t=!1,n=!1){e.observe(this.ce,{childList:t,subtree:n})}};var k=new l(x,z),S=(new l(x,z),new class{constructor(e,t,n){i(this,h),this.name=e,this.version=t,this.o=n,this.pe="1.0.0",this.be=null,this.fe="!#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~",this.Y=1e3,this.ae=3,this.ge=null,this.we=null,this.ve="bm-C",this.ye="div#map canvas.maplibregl-canvas",this.xe=null,this.ze="",this.re=[],this.oe=null,this.Me=!0,this.$e=new Map}ke(){if(document.body.contains(this.ge))return this.ge;document.getElementById(this.ve)?.remove();const e=document.querySelector(this.ye),t=document.createElement("canvas");return t.id=this.ve,t.className="maplibregl-canvas",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.height=e?.clientHeight*(window.devicePixelRatio||1)+"px",t.style.width=e?.clientWidth*(window.devicePixelRatio||1)+"px",t.height=e?.clientHeight*(window.devicePixelRatio||1),t.width=e?.clientWidth*(window.devicePixelRatio||1),t.style.zIndex="8999",t.style.pointerEvents="none",e?.parentElement?.appendChild(t),this.ge=t,window.addEventListener("move",this.Se),window.addEventListener("zoom",this.Te),window.addEventListener("resize",this.De),this.ge}async Oe(){return{whoami:this.name.replace(" ",""),scriptVersion:this.version,schemaVersion:this.pe,templates:{}}}async _e(e,t,n){this.oe||(this.oe=await this.Oe(),console.log("Creating JSON...")),this.o.V(`Creating template at ${n.join(", ")}...`);const i=new y({displayName:t,F:0,G:m(this.be||0,this.fe),file:e,coords:n}),{ne:a,ie:r}=await i.ee(this.Y);i.X=a;const s=`${i.F} ${i.G}`;i.R=s,this.oe.templates[s]={name:i.displayName,coords:n.join(", "),enabled:!0,tiles:r,palette:i.H},this.re=[],this.re.push(i);const l=(new Intl.NumberFormat).format(i.W);this.o.V(`Template created at ${n.join(", ")}! Total pixels: ${l}`);try{const e=document.querySelector("#bm-9");e&&(e.style.display=""),window.postMessage({source:"blue-marble",se:"bm-b"},"*")}catch(e){}console.log(Object.keys(this.oe.templates).length),console.log(this.oe),console.log(this.re),console.log(JSON.stringify(this.oe)),await o(this,h,p).call(this)}Be(){}async je(){this.oe||(this.oe=await this.Oe(),console.log("Creating JSON..."))}async Ce(e,t){if(!this.Me)return e;const n=this.Y*this.ae;t=t[0].toString().padStart(4,"0")+","+t[1].toString().padStart(4,"0"),console.log(`Searching for templates in tile: "${t}"`);const i=this.re;if(console.log(i),i.sort((e,t)=>e.F-t.F),console.log(i),!i.some(e=>!!e?.X&&(e.U&&e.U.size>0?e.U.has(t):Object.keys(e.X).some(e=>e.startsWith(t)))))return e;const o=i.map(e=>{const n=Object.keys(e.X).filter(e=>e.startsWith(t));if(0===n.length)return null;const i=n.map(t=>{const n=t.split(",");return{Ne:e.X[t],Ie:[n[0],n[1]],Pe:[n[2],n[3]]}});return i?.[0]}).filter(Boolean);console.log(o);const a=o?.length||0;console.log(`templateCount = ${a}`);let r=0,s=0,l=0;const c=await createImageBitmap(e),m=new OffscreenCanvas(n,n),u=m.getContext("2d");u.imageSmoothingEnabled=!1,u.beginPath(),u.rect(0,0,n,n),u.clip(),u.clearRect(0,0,n,n),u.drawImage(c,0,0,n,n);let d=null;try{d=u.getImageData(0,0,n,n).data}catch(e){}for(const e of o){if(console.log("Template:"),console.log(e),d)try{const t=e.Ne.width,i=e.Ne.height,o=new OffscreenCanvas(t,i).getContext("2d",{te:!0});o.imageSmoothingEnabled=!1,o.clearRect(0,0,t,i),o.drawImage(e.Ne,0,0);const a=o.getImageData(0,0,t,i).data,c=Number(e.Pe[0])*this.ae,m=Number(e.Pe[1])*this.ae;for(let e=0;e<i;e++)for(let i=0;i<t;i++){if(i%this.ae!==1||e%this.ae!==1)continue;const o=i+c,u=e+m;if(o<0||u<0||o>=n||u>=n)continue;const h=4*(e*t+i),p=a[h],b=a[h+1],f=a[h+2];if(a[h+3]<64){try{const e=this.re?.[0],t=4*(u*n+o),i=d[t],a=d[t+1],r=d[t+2],l=d[t+3],c=e.K.has(`${i},${a},${r}`)?`${i},${a},${r}`:"other",m=!!e?.K&&e.K.has(c);l>=64&&m&&s++}catch(e){}continue}l++;const g=4*(u*n+o),w=d[g],v=d[g+1],y=d[g+2];d[g+3]<64||(w===p&&v===b&&y===f?r++:s++)}}catch(e){console.warn("Failed to compute per-tile painted/wrong stats:",e)}try{const t=this.re?.[0],n=t?.H||{};if(Object.values(n).some(e=>!1===e?.enabled)){console.log("Applying color filter...");const i=e.Ne.width,o=e.Ne.height,a=new OffscreenCanvas(i,o),r=a.getContext("2d",{te:!0});r.imageSmoothingEnabled=!1,r.clearRect(0,0,i,o),r.drawImage(e.Ne,0,0);const s=r.getImageData(0,0,i,o),l=s.data;for(let e=0;e<o;e++)for(let o=0;o<i;o++){if(o%this.ae!==1||e%this.ae!==1)continue;const a=4*(e*i+o),r=l[a],s=l[a+1],c=l[a+2];if(l[a+3]<1)continue;let m=t.K.has(`${r},${s},${c}`)?`${r},${s},${c}`:"other";(!t?.K||t.K.has(m))&&!1!==n?.[m]?.enabled||(l[a+3]=0)}r.putImageData(s,0,0),u.drawImage(a,Number(e.Pe[0])*this.ae,Number(e.Pe[1])*this.ae)}else u.drawImage(e.Ne,Number(e.Pe[0])*this.ae,Number(e.Pe[1])*this.ae)}catch(t){console.warn("Failed to apply color filter:",t),u.drawImage(e.Ne,Number(e.Pe[0])*this.ae,Number(e.Pe[1])*this.ae)}}if(a>0){const e=t;this.$e.set(e,{Ae:r,required:l,Ee:s});let n=0,i=0,o=0;for(const e of this.$e.values())n+=e.Ae||0,i+=e.required||0,o+=e.Ee||0;const c=this.re.reduce((e,t)=>e+(t.J||t.W||0),0),m=c>0?c:i,u=(new Intl.NumberFormat).format(n),d=(new Intl.NumberFormat).format(m),h=(new Intl.NumberFormat).format(m-n);this.o.V(`Displaying ${a} template${1==a?"":"s"}.\nPainted ${u} / ${d} • Wrong ${h}`)}else this.o.V(`Displaying ${a} templates.`);return await m.convertToBlob({type:"image/png"})}Le(e){console.log("Importing JSON..."),console.log(e),"BlueMarble"==e?.whoami&&o(this,h,b).call(this,e)}Ve(e){this.Me=e}}(x,z,k)),T=new class{constructor(e){i(this,f),this.Fe=e,this.Ge=!1,this.Xe=[],this.Ye=[]}We(e){window.addEventListener("message",async t=>{const n=t.data,i=n.jsonData;if(!n||"blue-marble"!==n.source)return;if(!n.endpoint)return;const o=n.endpoint?.split("?")[0].split("/").filter(e=>e&&isNaN(Number(e))).filter(e=>e&&!e.includes(".")).pop();switch(console.log('%cBlue Marble%c: Recieved message about "%s"',"color: cornflowerblue;","",o),o){case"me":if(i.status&&"2"!=i.status?.toString()[0])return void e.L("You are not logged in!\nCould not fetch userdata.");const t=Math.ceil(Math.pow(Math.floor(i.level)*Math.pow(30,.65),1/.65)-i.pixelsPainted);console.log(i.id),(i.id||0===i.id)&&console.log(m(i.id,"!#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~")),this.Fe.be=i.id,e.j("bm-u",`${s("ui.username")} <b>${function(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}(i.name)}</b>`),e.j("bm-p",`${s("ui.droplets")} <b>${(new Intl.NumberFormat).format(i.droplets)}</b>`),e.j("bm-i",`${s("ui.next_level")} <b>${(new Intl.NumberFormat).format(t)}</b> ${s(1==t?"ui.pixel":"ui.pixels")}`);break;case"pixel":const o=n.endpoint.split("?")[0].split("/").filter(e=>e&&!isNaN(Number(e))),l=new URLSearchParams(n.endpoint.split("?")[1]),c=[l.get("x"),l.get("y")];if(this.Xe.length&&(!o.length||!c.length))return void e.L("Coordinates are malformed!\nDid you try clicking the canvas first?");this.Xe=[...o,...c];const u=(a=o,r=c,[parseInt(a[0])%4*1e3+parseInt(r[0]),parseInt(a[1])%4*1e3+parseInt(r[1])]),d=document.querySelectorAll("span");for(const e of d)if(e.textContent.trim().includes(`${u[0]}, ${u[1]}`)){let t=document.querySelector("#bm-h");const n=`(Tl X: ${o[0]}, Tl Y: ${o[1]}, Px X: ${c[0]}, Px Y: ${c[1]})`;t?t.textContent=n:(t=document.createElement("span"),t.id="bm-h",t.textContent=n,t.style="margin-left: calc(var(--spacing)*3); font-size: small;",e.parentNode.parentNode.parentNode.insertAdjacentElement("afterend",t))}break;case"tiles":let h=n.endpoint.split("/");h=[parseInt(h[h.length-2]),parseInt(h[h.length-1].replace(".png",""))];const p=n.blobID,b=n.blobData,f=await this.Fe.Ce(b,h);window.postMessage({source:"blue-marble",blobID:p,blobData:f,blink:n.blink});break;case"robots":this.Ge="false"==i.userscript?.toString().toLowerCase();break}var a,r})}async Je(e){console.log("Sending heartbeat to telemetry server...");let t=GM_getValue("bmUserSettings","{}");if(t=JSON.parse(t),!t||!t.telemetry||!t.uuid)return void console.log("Telemetry is disabled, not sending heartbeat.");const n=navigator.userAgent;let i=await o(this,f,g).call(this,n),a=o(this,f,w).call(this,n);GM_xmlhttpRequest({method:"POST",url:"https://telemetry.thebluecorner.net/heartbeat",headers:{"Content-Type":"application/json"},data:JSON.stringify({uuid:t.uuid,version:e,browser:i,os:a}),onload:e=>{200!==e.status&&c("Failed to send heartbeat:",e.statusText)},onerror:e=>{c("Error sending heartbeat:",e)}})}}(S);k.u(T);var D=JSON.parse(GM_getValue("bmTemplates","{}"));console.log(D),S.Le(D);var O=JSON.parse(GM_getValue("bmUserSettings","{}"));if(console.log(O),console.log(Object.keys(O).length),0==Object.keys(O).length){const e=crypto.randomUUID();console.log(e),GM.setValue("bmUserSettings",JSON.stringify({uuid:e}))}if(setInterval(()=>T.Je(z),18e5),console.log(`Telemetry is ${!(null==O?.telemetry)}`),null==O?.telemetry||O?.telemetry>1){const e=new l(x,z);e.u(T),e.v({id:"bm-d",style:"top: 0px; left: 0px; width: 100vw; max-width: 100vw; height: 100vh; max-height: 100vh; z-index: 9999;"}).v({id:"bm-7",style:"display: flex; flex-direction: column; align-items: center;"}).v({id:"bm-1",style:"margin-top: 10%;"}).S(1,{textContent:s("telemetry.title",{name:x})}).h().h().v({id:"bm-e",style:"max-width: 50%; overflow-y: auto; max-height: 80vh;"}).T().h().D().h().v({style:"width: fit-content; margin: auto; text-align: center;"})._({id:"bm-8",textContent:s("telemetry.more_info")},(e,t)=>{t.onclick=()=>{window.open("https://github.com/SwingTheVine/Wplace-TelemetryServer#telemetry-data","_blank","noopener noreferrer")}}).h().h().D().h().v({style:"width: fit-content; margin: auto; text-align: center;"})._({id:"bm-5",textContent:s("telemetry.enable"),style:"margin-right: 2ch;"},(e,t)=>{t.onclick=()=>{const e=JSON.parse(GM_getValue("bmUserSettings","{}"));e.telemetry=1,GM.setValue("bmUserSettings",JSON.stringify(e));const t=document.getElementById("bm-d");t&&(t.style.display="none")}}).h()._({id:"bm-2",textContent:s("telemetry.disable")},(e,t)=>{t.onclick=()=>{const e=JSON.parse(GM_getValue("bmUserSettings","{}"));e.telemetry=0,GM.setValue("bmUserSettings",JSON.stringify(e));const t=document.getElementById("bm-d");t&&(t.style.display="none")}}).h().h().D().h().M({textContent:s("telemetry.description")}).h().M({textContent:s("telemetry.disable_info")}).h().h().h().p(document.body)}!function(){let e=!1,t=!1,n={},i={};try{n=JSON.parse(GM_getValue("bmCoords","{}"))||{}}catch(e){n={}}try{i=JSON.parse(GM_getValue("bmUIPrefs","{}"))||{}}catch(e){i={}}t=i.qe||!1;const o=()=>{try{const e=Number(document.querySelector("#bm-v")?.value||""),t=Number(document.querySelector("#bm-w")?.value||""),n={He:e,Ue:t,px:Number(document.querySelector("#bm-x")?.value||""),Re:Number(document.querySelector("#bm-y")?.value||"")};GM.setValue("bmCoords",JSON.stringify(n))}catch(e){}};function l(){["#bm-c","#bm-a","#bm-4",`#${k.i}`,"#bm-6","#bm-9"].forEach(e=>{const t=document.querySelector(e);t&&(t.style.display="none")});const e=document.querySelector('#bm-f > div[style*="display: flex"]');e&&(e.style.display="none");const t=document.querySelector("#bm-6"),n=t?.querySelector("small");t&&n&&(t.style.display="",Array.from(t.children).forEach(e=>{e.style.display=e!==n?"none":""}));const i=document.querySelector("#bm-A");i&&(i.style.maxWidth="220px",i.style.minWidth="180px")}k.v({id:"bm-A",style:"top: 10px; right: 75px;"}).v({id:"bm-j"}).v({id:"bm-z"}).h().v({style:"display: flex; align-items: center; justify-content: space-between;"}).k({alt:s("tooltip.minimize_maximize"),src:"https://raw.githubusercontent.com/SwingTheVine/Wplace-BlueMarble/main/dist/assets/Favicon.png",style:"cursor: pointer;"},(n,i)=>{i.addEventListener("click",()=>{e=!e;const o=document.querySelector("#bm-A"),a=document.querySelector("#bm-j"),r=document.querySelector("#bm-z"),c=document.querySelector("#bm-k"),m=document.querySelector("#bm-q"),u=document.querySelector("#bm-r"),d=document.querySelector("#bm-s"),h=document.querySelector("#bm-l"),p=document.querySelectorAll("#bm-k input"),b=document.querySelector("#bm-Z");e||(o.style.width="auto",o.style.maxWidth="300px",o.style.minWidth="200px",o.style.padding="10px"),["#bm-A h1","#bm-f","#bm-A hr","#bm-c > *:not(#bm-k)","#bm-a","#bm-6",`#${n.i}`,"#bm-9"].forEach(t=>{document.querySelectorAll(t).forEach(t=>{t.style.display=e?"none":""})}),e?(c&&(c.style.display="none"),m&&(m.style.display="none"),u&&(u.style.display="none"),d&&(d.style.display="none"),h&&(h.style.display="none"),b&&(b.style.display="none"),p.forEach(e=>{e.style.display="none"}),o.style.width="60px",o.style.height="76px",o.style.maxWidth="60px",o.style.minWidth="60px",o.style.padding="8px",i.style.marginLeft="3px",a.style.textAlign="center",a.style.margin="0",a.style.marginBottom="0",r&&(r.style.display="",r.style.marginBottom="0.25em")):(c&&(c.style.display="",c.style.flexDirection="",c.style.justifyContent="",c.style.alignItems="",c.style.gap="",c.style.textAlign="",c.style.margin=""),m&&(m.style.display=""),u&&(u.style.display="",u.style.marginTop=""),d&&(d.style.display="",d.style.marginTop=""),h&&(h.style.display="",h.style.marginTop=""),b&&(b.style.display=""),p.forEach(e=>{e.style.display=""}),i.style.marginLeft="",o.style.padding="10px",a.style.textAlign="",a.style.margin="",a.style.marginBottom="",r&&(r.style.marginBottom="0.5em"),o.style.width="",o.style.height="",t&&setTimeout(()=>l(),10)),i.alt=s(e?"tooltip.minimized":"tooltip.maximized")})}).h()._({id:"bm-Z",style:"background: none; border: none; color: white; cursor: pointer; font-size: 16px; padding: 4px;",innerHTML:"◐",title:s("ui.toggle_simplified")},(e,n)=>{n.addEventListener("click",()=>{t=!t,(()=>{try{const e={qe:t};GM.setValue("bmUIPrefs",JSON.stringify(e))}catch(e){}})(),t?(l(),e.V(s("ui.simplified_mode")+" "+s("ui.enable"))):(function(){["#bm-c","#bm-a","#bm-4",`#${k.i}`,"#bm-6","#bm-9"].forEach(e=>{const t=document.querySelector(e);t&&(t.style.display="")});const e=document.querySelector('#bm-f > div[style*="display: flex"]');e&&(e.style.display="flex");const t=document.querySelector("#bm-6");t&&Array.from(t.children).forEach(e=>{e.style.display=""});const n=document.querySelector("#bm-A");n&&(n.style.maxWidth="300px",n.style.minWidth="200px")}(),e.V(s("ui.simplified_mode")+" "+s("ui.disable")))})}).h().h().S(1,{textContent:x}).h().h().T().h().v({id:"bm-f"}).M({id:"bm-u",textContent:s("ui.username")}).h().M({id:"bm-p",textContent:s("ui.droplets")}).h().M({id:"bm-i",textContent:s("ui.next_level")}).h().v({style:"display: flex; align-items: center; gap: 8px; margin-top: 8px;"}).$({textContent:s("ui.language"),style:"margin: 0;"}).h().N({id:"bm-W",style:"padding: 2px 4px; font-size: 11px;"},(e,t)=>{const n=function(){const e=new Set;return Object.values(a).forEach(t=>{Object.keys(t).forEach(t=>e.add(t))}),Array.from(e).sort()}(),i=r;n.forEach(e=>{const n=document.createElement("option");n.value=e,n.textContent=s(`lang.${e}`),e===i&&(n.selected=!0),t.appendChild(n)}),t.addEventListener("change",e=>{!function(e){if(Object.keys(a).some(t=>a[t][e])){r=e;try{const t=JSON.parse(GM_getValue("bmUserSettings","{}"));t.language=e,GM.setValue("bmUserSettings",JSON.stringify(t))}catch(e){}}}(e.target.value),location.reload()})}).h().h().h().T().h().v({id:"bm-c"}).v({id:"bm-k"})._({id:"bm-q",className:"bm-D",style:"margin-top: 0;",innerHTML:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 6"><circle cx="2" cy="2" r="2"></circle><path d="M2 6 L3.7 3 L0.3 3 Z"></path><circle cx="2" cy="2" r="0.7" fill="white"></circle></svg></svg>'},(e,t)=>{t.onclick=()=>{const t=e.t?.Xe;t?.[0]?(e.j("bm-v",t?.[0]||""),e.j("bm-w",t?.[1]||""),e.j("bm-x",t?.[2]||""),e.j("bm-y",t?.[3]||""),o()):e.L(s("error.coordinates_malformed"))}}).h().C({type:"number",id:"bm-v",placeholder:s("placeholder.tile_x"),min:0,max:2047,step:1,required:!0,value:n.He??""},(e,t)=>{t.addEventListener("paste",e=>{let t=(e.clipboardData||window.clipboardData).getData("text").split(" ").filter(e=>e).map(Number).filter(e=>!isNaN(e));if(4!==t.length)return;let n=(i=document,coords=[],coords.push(i.querySelector("#bm-v")),coords.push(i.querySelector("#bm-w")),coords.push(i.querySelector("#bm-x")),coords.push(i.querySelector("#bm-y")),coords);var i;for(let e=0;e<n.length;e++)n[e].value=t[e];e.preventDefault()});const n=()=>o();t.addEventListener("input",n),t.addEventListener("change",n)}).h().C({type:"number",id:"bm-w",placeholder:s("placeholder.tile_y"),min:0,max:2047,step:1,required:!0,value:n.Ue??""},(e,t)=>{const n=()=>o();t.addEventListener("input",n),t.addEventListener("change",n)}).h().C({type:"number",id:"bm-x",placeholder:s("placeholder.pixel_x"),min:0,max:2047,step:1,required:!0,value:n.px??""},(e,t)=>{const n=()=>o();t.addEventListener("input",n),t.addEventListener("change",n)}).h().C({type:"number",id:"bm-y",placeholder:s("placeholder.pixel_y"),min:0,max:2047,step:1,required:!0,value:n.Re??""},(e,t)=>{const n=()=>o();t.addEventListener("input",n),t.addEventListener("change",n)}).h().h().v({id:"bm-9",style:"max-height: 140px; overflow: auto; border: 1px solid rgba(255,255,255,0.1); padding: 4px; border-radius: 4px; display: none;"}).v({style:"display: flex; gap: 6px; margin-bottom: 6px;"})._({id:"bm-3",textContent:s("ui.enable_all")},(e,t)=>{t.onclick=()=>{const t=S.re[0];t?.H&&(Object.values(t.H).forEach(e=>e.enabled=!0),buildColorFilterList(),e.V(t("message.enabled_all_colors")))}}).h()._({id:"bm-0",textContent:s("ui.disable_all")},(e,t)=>{t.onclick=()=>{const t=S.re[0];t?.H&&(Object.values(t.H).forEach(e=>e.enabled=!1),buildColorFilterList(),e.V(t("message.disabled_all_colors")))}}).h().h().v({id:"bm-g"}).h().h().I({id:"bm-a",textContent:s("ui.upload_template"),accept:"image/png, image/jpeg, image/webp, image/bmp, image/gif"}).h().v({id:"bm-4"})._({id:"bm-s",textContent:s("ui.enable")},(e,t)=>{t.onclick=()=>{e.t?.Fe?.Ve(!0),e.V(s("message.enabled_templates"))}}).h()._({id:"bm-r",textContent:s("ui.create")},(e,t)=>{t.onclick=()=>{const t=document.querySelector("#bm-a"),n=document.querySelector("#bm-v");if(!n.checkValidity())return n.reportValidity(),void e.L(s("error.coordinates_malformed"));const i=document.querySelector("#bm-w");if(!i.checkValidity())return i.reportValidity(),void e.L(s("error.coordinates_malformed"));const o=document.querySelector("#bm-x");if(!o.checkValidity())return o.reportValidity(),void e.L(s("error.coordinates_malformed"));const a=document.querySelector("#bm-y");if(!a.checkValidity())return a.reportValidity(),void e.L(s("error.coordinates_malformed"));t?.files[0]?(S._e(t.files[0],t.files[0]?.name.replace(/\.[^/.]+$/,""),[Number(n.value),Number(i.value),Number(o.value),Number(a.value)]),e.V(s("message.drew_to_canvas"))):e.L(s("error.no_file_selected"))}}).h()._({id:"bm-l",textContent:s("ui.disable")},(e,t)=>{t.onclick=()=>{e.t?.Fe?.Ve(!1),e.V(s("message.disabled_templates"))}}).h().h().P({id:k.i,placeholder:s("placeholder.status_sleeping",{version:z}),readOnly:!0}).h().v({id:"bm-6"}).v()._({id:"bm-m",className:"bm-D",innerHTML:"🎨",title:s("tooltip.template_color_converter")},(e,t)=>{t.addEventListener("click",()=>{window.open("https://pepoafonso.github.io/color_converter_wplace/","_blank","noopener noreferrer")})}).h()._({id:"bm-n",className:"bm-D",innerHTML:"🌐",title:s("tooltip.official_website")},(e,t)=>{t.addEventListener("click",()=>{window.open("https://bluemarble.camilledaguin.fr/","_blank","noopener noreferrer")})}).h().h().$({textContent:s("ui.made_by"),style:"margin-top: auto;"}).h().h().h().p(document.body),t&&setTimeout(()=>l(),100),window.buildColorFilterList=function(){const e=document.querySelector("#bm-g"),t=S.re?.[0];if(!e||!t?.H)return void(e&&(e.innerHTML=`<small>${t("placeholder.no_template_colors")}</small>`));e.innerHTML="";const n=Object.entries(t.H).sort((e,t)=>t[1].count-e[1].count);for(const[i,o]of n){let n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.gap="8px",n.style.margin="4px 0";let a=document.createElement("div");a.style.width="14px",a.style.height="14px",a.style.border="1px solid rgba(255,255,255,0.5)";let r=document.createElement("span");r.style.fontSize="12px";let s=`${o.count.toLocaleString()}`;if("other"===i)a.style.background="#888",s=`${t("color.other")} • ${s}`;else if("#deface"===i)a.style.background="#deface",s=`${t("color.transparent")} • ${s}`;else{const[e,t,n]=i.split(",").map(Number);a.style.background=`rgb(${e},${t},${n})`;try{const o=S.re?.[0]?.Z?.get(i);if(o&&"number"==typeof o.id){const i=o?.name||`rgb(${e},${t},${n})`,a=o.premium?"★ ":"";s=`#${o.id} ${a}${i} • ${s}`}}catch(e){}}r.textContent=s;const l=document.createElement("input");l.type="checkbox",l.checked=!!o.enabled,l.addEventListener("change",()=>{o.enabled=l.checked,k.V(`${l.checked?"Enabled":"Disabled"} ${i}`);try{const e=S.re?.[0],t=e?.R;e&&t&&S.oe?.templates?.[t]&&(S.oe.templates[t].palette=e.H,GM.setValue("bmTemplates",JSON.stringify(S.oe)))}catch(e){}}),n.appendChild(l),n.appendChild(a),n.appendChild(r),e.appendChild(n)}},window.addEventListener("message",e=>{if("bm-b"===e?.data?.se)try{buildColorFilterList()}catch(e){}}),setTimeout(()=>{try{if(S.re?.length>0){const e=document.querySelector("#bm-9");e&&(e.style.display=""),buildColorFilterList()}}catch(e){}},0)}(),k.A("#bm-A","#bm-z"),T.We(k),new MutationObserver((e,t)=>{const n=document.querySelector("#color-1");if(!n)return;let i=document.querySelector("#bm-t");if(!i){i=document.createElement("button"),i.id="bm-t",i.textContent=s("ui.move_up"),i.className="btn btn-soft",i.onclick=function(){const e=this.parentNode.parentNode.parentNode.parentNode,t=this.textContent==s("ui.move_up");e.parentNode.className=e.parentNode.className.replace(t?"bottom":"top",t?"top":"bottom"),e.style.borderTopLeftRadius=t?"0px":"var(--radius-box)",e.style.borderTopRightRadius=t?"0px":"var(--radius-box)",e.style.borderBottomLeftRadius=t?"var(--radius-box)":"0px",e.style.borderBottomRightRadius=t?"var(--radius-box)":"0px",this.textContent=s(t?"ui.move_down":"ui.move_up")};const e=n.parentNode.parentNode.parentNode.parentNode.querySelector("h2");e.parentNode?.appendChild(i)}}).observe(document.body,{childList:!0,subtree:!0}),function(...e){(0,console.log)(...e)}(`%c${x}%c ${s("console.userscript_loaded",{version:z})}`,"color: cornflowerblue;","")})();