# Blue Marble 国际化 (i18n) 文档

## 概述

Blue Marble userscript 现在支持多语言界面，让全球用户都能使用母语操作脚本。国际化系统会自动检测用户的浏览器语言，并提供相应的翻译。

## 支持的语言

- **英语 (English)** - `en` (默认语言)
- **简体中文 (Simplified Chinese)** - `zh-cn`
- **繁体中文 (Traditional Chinese)** - `zh-tw`
- **日语 (Japanese)** - `ja`
- **韩语 (Korean)** - `ko`
- **西班牙语 (Spanish)** - `es`
- **法语 (French)** - `fr`
- **德语 (German)** - `de`
- **俄语 (Russian)** - `ru`
- **葡萄牙语 (Portuguese)** - `pt`

## 功能特性

### 自动语言检测
- 系统会自动检测用户浏览器的语言设置
- 特别针对中文用户，会智能区分简体中文和繁体中文
- 如果检测到不支持的语言，会回退到英语

### 手动语言切换
- 用户可以通过界面上的语言选择器手动切换语言
- 语言偏好会自动保存，下次使用时保持选择的语言
- 切换语言后会自动刷新界面以确保所有文本更新

### 完整的界面翻译
以下界面元素已完全国际化：

#### 主界面
- 按钮文本（启用、禁用、创建、上传模板等）
- 用户信息标签（用户名、水滴、等级信息）
- 状态提示和占位符文本
- 工具提示和帮助文本

#### 错误和状态消息
- 坐标格式错误提示
- 文件选择提示
- 模板操作状态反馈
- 颜色过滤器操作提示

#### 遥测设置
- 遥测说明和按钮文本
- 隐私政策说明
- 用户选择按钮

#### 颜色管理
- 颜色名称（透明、其他等）
- 颜色过滤器操作按钮
- 模板颜色显示标签

## 技术实现

### 核心文件
- `src/i18n.js` - 国际化核心模块，包含所有翻译数据和语言管理功能

### 翻译键值结构
```javascript
'key.identifier': {
  'en': 'English text',
  'zh-cn': '简体中文文本',
  'zh-tw': '繁體中文文本',
  // ... 其他语言
}
```

### 使用方法
在代码中使用翻译函数：
```javascript
import { t } from './i18n.js';

// 简单翻译
const text = t('ui.enable');

// 带参数的翻译
const message = t('console.userscript_loaded', { version: '0.85.0' });
```

### 语言管理函数
```javascript
import { 
  setLanguage, 
  getCurrentLanguage, 
  getAvailableLanguages,
  detectLanguage 
} from './i18n.js';

// 设置语言
setLanguage('zh-cn');

// 获取当前语言
const current = getCurrentLanguage();

// 获取所有可用语言
const languages = getAvailableLanguages();

// 自动检测语言
const detected = detectLanguage();
```

## 数据持久化

- 用户的语言选择会保存在 `bmUserSettings` 中
- 支持跨会话保持语言偏好
- 使用 GM_getValue 和 GM_setValue 进行数据存储

## 开发指南

### 添加新语言

1. 在 `src/i18n.js` 的翻译对象中添加新语言代码
2. 为所有现有的翻译键添加对应的翻译文本
3. 在 `detectLanguage()` 函数中添加语言检测逻辑
4. 更新 `getAvailableLanguages()` 返回的语言列表

### 添加新的翻译键

1. 在 `translations` 对象中添加新的键值对
2. 为所有支持的语言提供翻译文本
3. 在需要的地方使用 `t('your.new.key')` 调用翻译

### 最佳实践

1. **键名规范**：使用点分隔的命名空间，如 `ui.button.save`
2. **参数化翻译**：对于包含变量的文本，使用 `{变量名}` 占位符
3. **回退机制**：确保每个键都有英语翻译作为回退
4. **上下文相关**：考虑不同语言的文化和语法差异

## 文件修改记录

### 新增文件
- `src/i18n.js` - 国际化核心模块

### 修改的文件
- `src/main.js` - 集成i18n，添加语言选择器
- `src/Overlay.js` - 添加i18n支持，新增addSelect方法
- `src/Template.js` - 添加i18n导入
- `src/templateManager.js` - 添加i18n导入
- `src/apiManager.js` - 添加i18n导入
- `src/observers.js` - 添加i18n导入

### 主要更改
1. 所有用户可见的文本都已使用 `t()` 函数包装
2. 添加了语言选择器组件到主界面
3. 实现了自动语言检测和持久化
4. 为Overlay类添加了addSelect方法支持下拉选择器

## 贡献翻译

欢迎为Blue Marble贡献翻译！如果您发现翻译错误或希望添加新语言支持：

1. 检查现有翻译的准确性
2. 为新语言添加完整的翻译集
3. 考虑文化适应性和本地化需求
4. 测试界面在不同语言下的显示效果

## 注意事项

- 语言切换会触发页面刷新以确保所有界面元素正确更新
- 某些调试信息和console输出保持英语以便开发者调试
- 翻译会根据用户反馈持续优化和改进

通过这个国际化系统，Blue Marble现在能够为全球用户提供更好的使用体验！
